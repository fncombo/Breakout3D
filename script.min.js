(function(d,K,N){var D,o,w,I,s=K.location.hash==="#fps"?true:false,P,u,v,h,C,t,Y=[],m,R,G,F,E,b,O,U,J=6,g=15.17,W=20,k=Math.ceil(500/g),j,H=$("#loading"),l=$("#lives"),A=$("#wraths"),L=$("#points"),f=$("hgroup"),q={bouncing:false,state:0,amount:2,distance:3,direction:true},V=4+N.Math.random16(),T=-5+N.Math.random16(),c=[[0,J,1],[J,J,3],[J,0,1],[-J,-J,3],[0,-J,2],[J,-J,3],[-J,0,2],[-J,J,3]],X=true,M,e=1,p={1:{title:"Level 1",name:"The Executioner",music:"m_UHO60tkdg",bgColor:1377039,blockColors:{0:new N.MeshLambertMaterial({color:721161}),1:new N.MeshLambertMaterial({color:16682072}),2:new N.MeshLambertMaterial({color:14042494}),3:new N.MeshLambertMaterial({color:5057348})},map:"                                                                   0000000000000000000000000000000   3 3 3 3 3 3 3 3 3 3 3 3 3 3 3    3 3 3 3 3 3 3 3 3 3 3 3 3 3 3    3 3 3 3 3 3 3 3 3 3 3 3 3 3 3    3 3 3 3 3 3 3 3 3 3 3 3 3 3 3    3 3 3 3 3 3 3 3 3 3 3 3 3 3 3    3 3 3 3 3 3 3 3 3 3 3 3 3 3 3   0000000000000000000000000000000                                   2                             2  22                           22  2 2       1    1    1       2 2  2  2     111  111  111     2  2  2   2     1    1    1     2   2  2    2                   2    2  2     2                 2     2 000000000000000000000000000000000000000000000000000000000000000000"},2:{title:"Level 2",name:"Black Liliana",music:"LsGr8V1Q_1U",bgColor:329003,blockColors:{0:new N.MeshLambertMaterial({color:3291242}),1:new N.MeshLambertMaterial({color:5344153}),2:new N.MeshLambertMaterial({color:9525664}),3:new N.MeshLambertMaterial({color:15387567}),4:new N.MeshLambertMaterial({color:9739169})},map:"0  22  3333333333333333333  22  000  22  33333       33333  22  00 00  22  333    4    333  22  00   00  22  3    444    3  22  00     00  22     44444     22  00       00  22   4444444   22  00         00  22   44444   22  00           00  22   444   22  00         1   00  22   4   22  00   1     111   00  22     22  00   111   11111   00  22   22  00   11111   111   0000  22 22  0000   111     1   00  00  222  00  00   1         00    00  2  00    00           00      00   00      00         00   1    00 00    1   00       00   111    000    111   00     00   11111    0    11111   00   00     111           111     00 00       1             1       00"},3:{title:"Final Level",name:"Mirage Coordinator",music:"p85zQLOMlUY",bgColor:591624,blockColors:{0:new N.MeshLambertMaterial({color:16640582}),1:new N.MeshLambertMaterial({color:12068391}),2:new N.MeshLambertMaterial({color:5770765}),3:new N.MeshLambertMaterial({color:404525}),4:new N.MeshLambertMaterial({color:525831}),5:new N.MeshLambertMaterial({color:2242414})},map:"11122222222222222222222222222211111222222222222222222222222222221112            00000            2122  4   4   00     00   4   4  2222  44 44  0   4     0  44 44  2222   444  0 5 444  55 0  444   2222    4   0 5  4  5   0   4    22223      0   5   5  4  0      3222233     0    55 5 444 0     332222333    0  4   5   4  0    33322223333   0 444 5 55    0   3333222233333  0  4  5   5   0  333332222333333  0   5  4  5 0  33333322223333333 0 55  444 5 0 3333333222233333333 0     4   0 333333332222333333333300     00333333333322223333333333330000033333333333322123333333333333333333333333333321112222222222222222222222222222211111222222222222222222222222222111"}};function a(y){var z,x,ab,Z,aa,ad=[],af=0,ae=new N.CubeGeometry(g,g*0.5,g),ac=new N.SphereGeometry(g/2,g,g);if((e!==1&&y===1)||y!==1||y!==e){changeMusic(p[y].music)}e=y;$("h1").innerHTML=p[e].title;$("h2").innerHTML=p[e].name;D.setClearColorHex(p[e].bgColor,1);Y.forEach(function(n,i){if(n!==null&&!n.paddle){w.remove(n);delete Y[i]}});j=0;["sky","board","paddle","ball","particle"].forEach(function(i){ad[i]=N.ImageUtils.loadTexture("textures/level-"+e+"/"+i+".bmp",{},function(){af+=1;if(af===5){H.addClass("hide")}})});ad.board.wrapS=ad.board.wrapT=N.RepeatWrapping;ad.board.repeat.set(10,10);v.material.map=ad.sky;h.material.map=ad.board;Y[0].material.map=ad.paddle;C.material.map=ad.ball;t.material.map=ad.particle;ab=1;for(x=0;x<W;x+=1){for(z=0;z<k;z+=1){Z=p[e].map.charAt(ab-1);if(Z!==" "){aa=N.Math.random16()<0.05;Y[ab]=new N.Mesh(aa?ac:ae,p[e].blockColors[Z]);Y[ab].receiveShadow=Y[ab].castShadow=true;Y[ab].position.set((z*g)-250+(g/2),9,(x*g)-250+(g/2));Y[ab].blockNum=ab;Y[ab].blockSpecial=aa;w.add(Y[ab]);j+=1}ab+=1}}C.bouncing=false;C.position.set(Y[0].position.x,9,244);X=false}D=new N.WebGLRenderer({antialias:true});D.shadowMapEnabled=D.shadowMapSoft=true;D.setSize(K.innerWidth,K.innerHeight);D.sortObjects=false;w=new N.Scene();o=new N.PerspectiveCamera(45,K.innerWidth/K.innerHeight,0.1,10000);o.position.y=500;o.position.z=400;w.add(o);d.body.appendChild(D.domElement);I=new N.Projector();u=new N.PointLight(16777215,2);u.position.set(0,200,500);w.add(u);u=new N.SpotLight(16777215,2);u.position.set(0,350,500);u.shadowCameraNear=0.01;u.castShadow=true;u.shadowDarkness=0.3;u.shadowMapWidth=u.shadowMapHeight=2048;w.add(u);m=new N.PlaneGeometry(3500,1500);R=new N.MeshBasicMaterial();v=new N.Mesh(m,R);v.position.set(0,-500,-800);v.rotation.set(-900,0,0);w.add(v);m=new N.CubeGeometry(500,3,500);R=new N.MeshBasicMaterial();h=new N.Mesh(m,R);h.matrixAutoUpdate=false;h.receiveShadow=true;w.add(h);o.lookAt(h.position);m=new N.CubeGeometry(80,20,3);R=new N.MeshBasicMaterial();Y[0]=new N.Mesh(m,R);Y[0].paddle=true;Y[0].position.set(0,13,251.5);w.add(Y[0]);m=new N.SphereGeometry(6,16,16);R=new N.MeshLambertMaterial();C=new N.Mesh(m,R);C.castShadow=true;C.position.set(0,9,244);w.add(C);m=new N.Geometry();R=new N.ParticleBasicMaterial({size:6,blending:N.AdditiveBlending,transparent:true});for(O=0;O<=2;O+=1){for(U=0;U<=100;U+=1){switch(O){case 0:G=-250;E=N.Math.randInt(-250,250);break;case 1:G=250;E=N.Math.randInt(-250,250);break;case 2:G=N.Math.randInt(-250,250);E=-250;break}F=N.Math.randInt(0,20);b=new N.Vector3(G,F,E);m.vertices.push(b)}}t=new N.ParticleSystem(m,R);w.add(t);function Q(i,x){var y=parseInt(i.innerHTML,10)+x,n=$("#"+i.id+"-text");i.innerHTML=y;n.innerHTML=y===1?n.getAttribute("data-singular"):n.getAttribute("data-plural");return y}function r(){if(N.Math.random16()<0.25){Q(l,1)}else{Q(A,1)}Q(L,10)}function S(){var y,ae,Z,i=C.position,z=C.position.x,x=C.position.z,ad,ac,n,ab=c.length,aa=t.geometry.vertices.length;if(z<=-250||z>=250){V=-V}if(x<=-250){T=-T}if(x>=300&&parseInt(l.innerHTML,10)>0){C.bouncing=false;if(!Q(l,-1)){$("#died-points").innerHTML=L.innerHTML;if(parseInt(A.innerHTML,10)){$("#died-wraths-text").removeClass("hidden");$("#died-wraths").innerHTML=A.innerHTML}else{$("#died-wraths-text").addClass("hidden")}f.addClass("hide");$("#died").removeClass("hide")}else{C.position.set(Y[0].position.x,9,244)}}c.forEach(function(af){y=new N.Vector3(z+af[0],6,x+af[1]).subSelf(i).normalize();ae=new N.Raycaster(i,y);Z=ae.intersectObjects(Y);if(Z.length>0){Z.forEach(function(ah,ag){if(ah.distance<=J){if(ag===0){ad=4+(ah.distance*0.1);ac=5+(ah.distance*0.1);V=V<0?-ad:ad;T=T<0?-ac:ac;switch(af[2]){case 1:T=-T;break;case 2:V=-V;break;case 3:V=-V;T=-T;break}}if(ah.object.blockNum){if(Y[ah.object.blockNum].blockSpecial){r()}w.remove(Y[ah.object.blockNum]);Y[ah.object.blockNum]=null;j-=1;n=20-((new Date()-M)*0.01);n=n<0?1:n;Q(L,Math.round(n));M=new Date()}else{if(af[2]===1){q.bouncing=true;V=V<0?-ah.distance-1:ah.distance+1}}}})}});C.lookAt(o.position);if(C.bouncing){C.position.x+=V;C.position.z+=T}if(q.bouncing){if(q.direction){Y[0].position.z+=q.distance;if(q.state===q.amount){q.direction=false;q.state=0}else{q.state+=1}}else{Y[0].position.z-=q.distance;if(q.state===q.amount){q.direction=true;q.state=0;q.bouncing=false}else{q.state+=1}}}t.geometry.verticesNeedUpdate=true;t.geometry.vertices.forEach(function(af){af.y=af.y>20?0:af.y+0.2})}$("canvas").onmousemove=function(y){var x,z,n,Z,i;x=new N.Vector3((y.clientX/K.innerWidth)*2-1,0,1);I.unprojectVector(x,o);z=x.subSelf(o.position).normalize();n=new N.Ray(o.position,z);Z=-(o.position.z/z.z);i=o.position.clone().addSelf(z.multiplyScalar(Z));if(i.x>=-(275-Y[0].geometry.vertices[0].x)&&i.x<=(275-Y[0].geometry.vertices[0].x)){Y[0].position.x=i.x;u.position.x=i.x*1.5;if(!C.bouncing){C.position.x=i.x}}};$("canvas").onclick=function(){if(!C.bouncing){V=N.Math.random16()<0.5?V:-V;C.bouncing=true;M=new Date()}else{if(parseInt(A.innerHTML,10)){Q(A,-1);var n=j>=5?5:j,i;U=0;while(U<n){i=N.Math.randInt(1,Y.length);if(Y[i]!==null&&Y[i]!==undefined&&Y[i].blockNum){if(Y[i].blockSpecial){r()}w.remove(Y[i]);Y[i]=null;j-=1;Q(L,20);U+=1}}}}};K.onresize=function(){o.aspect=K.innerWidth/K.innerHeight;o.updateProjectionMatrix();D.setSize(K.innerWidth,K.innerHeight)};$("#play").onclick=function(){f.removeAttribute("class");$("#controls").addClass("hide")};$("#try-again").onclick=function(){a(e);if(e===1){l.innerHTML=A.innerHTML=3;L.innerHTML=0}else{[l,A,L].forEach(function(i){i.innerHTML=i.getAttribute("data-level-"+(e-1))})}f.removeClass("hide");$("#died").addClass("hide")};$("#next-level").onclick=function(){X=true;H.removeClass("hide");setTimeout(function(){a(e+1)},200);$("#well-done").addClass("hide");f.removeClass("hide")};$("#replay").onclick=function(){l.innerHTML=A.innerHTML=3;L.innerHTML=0;X=true;H.removeClass("hide");setTimeout(function(){a(1)},200);f.removeClass("hide");$("#completed").addClass("hide")};if(s){P=new Stats();P.domElement.style.position="absolute";P.domElement.style.top=P.domElement.style.left="0";d.body.appendChild(P.domElement)}a(1);(function B(){if(s){P.update()}S();if(!j&&!X){C.bouncing=false;f.addClass("hide");if(e===3){$("#completed").removeClass("hide");["points","lives","wraths"].forEach(function(i){$("#finish-"+i).innerHTML=parseInt($("#"+i).innerHTML,10)||"no"})}else{$("#well-done").removeClass("hide")}[l,A,L].forEach(function(i){i.setAttribute("data-level-"+e,i.innerHTML)})}requestAnimationFrame(B);D.render(w,o)}())}(document,window,THREE));var player;function changeMusic(a){player.loadVideoById(a)}function onPlayerReady(a){a.target.playVideo()}function onPlayerStateChange(a){if(a.data===0){a.target.playVideo()}}function onYouTubePlayerAPIReady(){player=new YT.Player("music",{events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})};